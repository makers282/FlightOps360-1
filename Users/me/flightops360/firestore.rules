
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Default deny all reads and writes
    match /{document=**} {
      allow read, write: if false;
    }

    // Users: Users can only read/write their own document
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Company Profile: Public read for dashboard, restricted write
    match /companyProfile/{profileId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Restrict to admin role
    }

    // Aircraft Fleet: Public read for dashboard, restricted write
    match /fleet/{aircraftId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Restrict to admin/maintenance roles
    }

    // Aircraft Rates: Read by authenticated, restricted write
    match /aircraftRates/{aircraftId} {
      allow read: if request.auth != null; // Assumes rates are not strictly public
      allow write: if request.auth != null; // TODO: Restrict to admin role
    }

    // Aircraft Performance Data: Read by authenticated, restricted write
    match /aircraftPerformanceData/{aircraftId} {
      allow read: if request.auth != null; // Assumes performance data is not strictly public
      allow write: if request.auth != null; // TODO: Restrict to admin/maintenance roles
    }

    // Component Times: Public read for dashboard, restricted write
    match /aircraftComponentTimes/{aircraftId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Probably should be restricted to system/admin or specific flows
    }

    // Maintenance Tasks: Public read for dashboard, restricted write
    match /maintenanceTasks/{taskId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Restrict to maintenance roles
    }
    
    // Aircraft Discrepancies: Public read for dashboard status, restricted write
    match /aircraftDiscrepancies/{discrepancyId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Refine based on who can log/update discrepancies
    }

    // Aircraft MEL Items: Public read for dashboard status, restricted write
    match /aircraftMelItems/{melItemId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Refine based on who can log/update MEL items
    }

    // Aircraft Block Outs: Public read for calendar, restricted write
    match /aircraftBlockOuts/{blockOutId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Refine based on who can schedule block outs
    }

    // Customers: Read by authenticated, restricted write
    match /customers/{customerId} {
      allow read: if request.auth != null; // TODO: Refine based on roles
      allow write: if request.auth != null; // TODO: Refine based on roles
    }

    // Quotes: Read by authenticated, restricted write
    match /quotes/{quoteId} {
      allow read: if request.auth != null; // TODO: More granular (e.g., user who created it, or admins)
      allow write: if request.auth != null; // TODO: Refine based on roles
    }

    // Trips: Public read for dashboard, restricted write
    match /trips/{tripId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Refine based on roles (dispatch, admin)
    }

    // Flight Logs: Read by authenticated, restricted write
    match /flightLogs/{flightLogId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }

    // Roles: Read by authenticated, restricted write
    match /roles/{roleId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null; // TODO: Restrict to admin role ONLY
    }
    
    // Company Documents: Public read, restricted write
    match /companyDocuments/{documentId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Restrict to admin or specific roles
    }

    // Aircraft Documents: Public read (metadata), restricted write
    match /aircraftDocuments/{documentId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Restrict to admin or specific roles
    }
    
    // Crew Documents: Read by authenticated, restricted write
    match /crewDocuments/{documentId} {
      allow read: if request.auth != null; // TODO: Granular access based on crewMemberId field and user's role/ID
      allow write: if request.auth != null; // TODO: Granular access
    }

    // Crew Members: Read by authenticated, restricted write
    match /crewMembers/{crewMemberId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null; // TODO: Restrict to admin/HR roles
    }

    // Bulletins: Public read, restricted write
    match /bulletins/{bulletinId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Restrict to admin role
    }

    // Notifications: Public read for now (for dashboard alerts), restricted write
    match /notifications/{notificationId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Highly refine based on userId field in notification or roles
    }
  }
}

    