
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Default deny all access
    match /{document=**} {
      allow read, write: if false;
    }

    // Users can only read/write their own document
    match /users/{userId} {
      allow read, update, delete: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null; // Or more specific rules if needed
    }

    // Bulletins are publicly readable, only authenticated can write (for now)
    match /bulletins/{bulletinId} {
      allow read: if true;
      allow write: if request.auth != null; // TODO: Refine: who can create/update/delete bulletins? (e.g., admins)
    }

    // Trips - Made publicly readable to fix current error, writes restricted
    match /trips/{tripId} {
      allow read: if true; // Authenticated users can read (was request.auth != null) - CHANGED FOR PUBLIC READ
      allow write: if request.auth != null; // TODO: Refine - who can create/update trips?
      // allow delete: if request.auth != null; // TODO: Refine - who can delete trips?
    }

    // Quotes - Only authenticated users can access for now
    match /quotes/{quoteId} {
      allow read, write: if request.auth != null; // TODO: Refine: specific user/role access for quotes
    }

    // Customers - Only authenticated users can access for now
    match /customers/{customerId} {
      allow read, write: if request.auth != null; // TODO: Refine: who can manage customers?
    }

    // Fleet - Only authenticated users can access for now
    match /fleet/{aircraftId} {
      allow read, write: if request.auth != null; // TODO: Refine: Only admins should manage fleet
    }

    // Aircraft Rates - Only authenticated users can access for now
    match /aircraftRates/{aircraftId} {
      allow read, write: if request.auth != null; // TODO: Refine: Only admins should manage rates
    }
    
    // Aircraft Performance Data - Only authenticated users can access for now
    match /aircraftPerformanceData/{aircraftId} {
      allow read, write: if request.auth != null; // TODO: Refine: Who manages this?
    }
    
    // Aircraft Component Times - Only authenticated users can access for now
    match /aircraftComponentTimes/{aircraftId} {
        allow read, write: if request.auth != null; // TODO: Refine: Usually updated by system/specific roles
    }

    // Maintenance Tasks - Only authenticated users can access for now
    match /maintenanceTasks/{taskId} {
        allow read, write: if request.auth != null; // TODO: Refine: Access by aircraft association or role
    }
    
    // Aircraft Discrepancies - Only authenticated users can access for now
    match /aircraftDiscrepancies/{discrepancyId} {
        allow read, write: if request.auth != null; // TODO: Refine
    }

    // Aircraft MEL Items - Only authenticated users can access for now
    match /aircraftMelItems/{melItemId} {
        allow read, write: if request.auth != null; // TODO: Refine
    }

    // Flight Logs - Only authenticated users can access for now
    match /flightLogs/{flightLogId} {
        allow read, write: if request.auth != null; // TODO: Refine
    }

    // Company Profile - Authenticated users can read, specific roles should write
    match /companyProfile/{profileId} {
        allow read: if request.auth != null;
        allow write: if request.auth != null; // TODO: Refine: Only admins or designated roles
    }
    
    // Roles - Only authenticated users can read for now
    match /roles/{roleId} {
        allow read: if request.auth != null;
        allow write: if request.auth != null; // TODO: Refine: Only admins should manage roles
    }

    // Notifications - Users can read/update their own notifications
    match /notifications/{notificationId} {
      allow read, update: if request.auth != null; // TODO: If notifications have a userId field: request.auth.uid == resource.data.userId
                                                // Or allow admins to read all
      allow create, delete: if request.auth != null; // TODO: Who can create/delete? System or specific roles
    }

    // Aircraft Documents - Authenticated users can manage
    match /aircraftDocuments/{documentId} {
      allow read, write: if request.auth != null; // TODO: Refine based on roles or aircraft ownership/assignment
    }

    // Company Documents - Authenticated users can manage
    match /companyDocuments/{documentId} {
      allow read, write: if request.auth != null; // TODO: Refine, e.g. read all, write by role
    }

    // Crew Documents - Authenticated users can manage
    match /crewDocuments/{documentId} {
      allow read, write: if request.auth != null; // TODO: Refine, e.g. crew read their own, HR/Admin write
    }
    
    // Crew Members - Authenticated users can manage for now
    match /crewMembers/{crewMemberId} {
      allow read, write: if request.auth != null; // TODO: Refine, HR/Admin write, crew read own/limited public view
    }
    
    // Aircraft Block Outs - Authenticated users can manage for now
    match /aircraftBlockOuts/{blockOutId} {
      allow read, write: if request.auth != null; // TODO: Refine, e.g. dispatch/admin write
    }
  }
}
